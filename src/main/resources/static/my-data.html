<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>GCMP</title>

    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="css/font.css" rel="stylesheet">
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href="css/gcmp.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="webuploader-0.1.5/webuploader.css">
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <script src="vendor/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="webuploader-0.1.5/webuploader.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="js/sb-admin-2.min.js"></script>
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>
    <script src="js/vue/2.5.16/vue.min.js"></script>
    <script src="js/axios/0.17.1/axios.min.js"></script>
    <script src="js/moment/2.22.2/moment.js"></script>
    <script src="js/gcmp.js"></script>
    <script>
        $(function () {

            var vue = new Vue({
                el: '#wrapper',
                data: {
                    uri: '/api/data',
                    datas: [],
                    relativePath: '',
                    file: false,
                    serverId: 0,
                    pathItems: [],
                    newPath: '',
                    availableGpus: [],
                    serverAvailableGpusUri: 'api/status/available_gpus',
                    user: {},
                    token: ""
                },
                mounted: function () {
                    this.getUser();
                    this.load();

                },
                methods: {
                    getUser: function () {
                        this.token = getUrlParam("token");
                        axios({
                            method: "get",
                            url: "/api/user/cur_user",
                            headers: {'Gcmp-Authorization': this.token}
                        }).then(function (response) {
                            vue.user = response.data.data;
                        }).catch(function (err) {
                            handleError(err);
                        })
                    },
                    load: function () {
                        this.refresh();
                        axios.get(this.serverAvailableGpusUri).then(function (response) {
                            vue.availableGpus = response.data.data;
                        });
                        window.setInterval(function () {
                            axios.get(vue.serverAvailableGpusUri).then(function (response) {
                                vue.availableGpus = response.data.data;
                            });
                        }, 1000 * 60)

                    },
                    selectSingle: function (element) {
                        var tgt = element.currentTarget;
                        var selected = tgt.getAttribute("selectedd")
                        if ("true" == selected) {
                            tgt.setAttribute("src", "/img/notSelected.png");
                            tgt.setAttribute("selectedd", "false")
                        } else {
                            tgt.setAttribute("src", "/img/selected.png");
                            tgt.setAttribute("selectedd", "true")
                        }
                        syncSelect();
                    },
                    selectAll: function (element) {
                        var tgt = element.currentTarget;
                        var selected = tgt.getAttribute("selectedd")
                        if ("true" == selected) {
                            tgt.setAttribute("src", "/img/notSelected.png");
                            tgt.setAttribute("selectedd", "false")
                            $(".selectSingle").each(function () {
                                $(this).attr("src", "/img/notSelected.png");
                                $(this).attr("selectedd", "false");
                            });
                        } else {
                            tgt.setAttribute("src", "/img/selected.png");
                            tgt.setAttribute("selectedd", "true")
                            $(".selectSingle").each(function () {
                                $(this).attr("src", "/img/selected.png");
                                $(this).attr("selectedd", "true");
                            });
                        }
                    },
                    refresh: function () {
                        var url = this.uri + "?relativePath=" + this.relativePath +
                            '&file=' + this.file + '&serverId=' + this.serverId;
                        axios({
                            method: 'get',
                            url: url,
                            headers: {'Gcmp-Authorization': this.token}
                        }).then(function (response) {
                            vue.datas = response.data.data;
                        });
                        this.pathItems = this.relativePath.split('/')
                        notselectAll();
                    },

                    intoDir: function (element) {
                        var tgt = element.currentTarget;
                        this.relativePath += '/' + tgt.innerText;
                        this.newPath = this.relativePath
                        this.refresh()
                    },
                    jumpDir: function (index) {
                        this.relativePath = '';
                        for (var i = 0; i <= index; i++) {
                            this.relativePath += this.pathItems[i] + '/';
                        }
                        if (this.relativePath != '') {
                            this.relativePath = this.relativePath.substr(0, this.relativePath.length - 1);
                        }
                        this.refresh();
                    },

                    download: function () {
                        var selectedList = getSelectedList()
                        for (let i = 0; i < selectedList.length; i++) {
                            var idx = selectedList[i];
                            var path = this.relativePath + '/' + this.datas[idx].name;
                            var isFile = this.datas[idx].file;
                            if (Boolean(isFile)) {
                                var url = "/api/data/download" + "?relativePath=" + path +
                                    '&file=' + isFile + '&serverId=' + this.serverId +
                                    '&gcmp_token=' + this.token;
                                window.open(url, "_blank");
                            }
                        }
                        this.notselectAll();
                    },
                    remove: async function () {
                        var selectedList = getSelectedList()
                        for (let i = 0; i < selectedList.length; i++) {
                            var idx = selectedList[i];
                            var path = this.relativePath + '/' + this.datas[idx].name;
                            var isFile = this.datas[idx].file;
                            showErrMsg("正在删除" + this.datas[idx].name + "...", -1);

                            await axios({
                                method: "delete",
                                data: {
                                    relativePath: path,
                                    file: isFile,
                                    serverId: this.serverId
                                },
                                url: this.uri,
                                headers: {'Gcmp-Authorization': this.token}

                            }).then(function (response) {
                                vue.rst(i, selectedList.length - 1)
                            }).catch(function (err) {
                                handleError(err);
                            });
                        }
                    },

                    rename: function () {
                        $("#renameModal").modal("hide")
                        var sl = getSelectedList();
                        if (sl.length != 1) {
                            showErrMsg("必须且只能选择一个！", 1500)

                        } else {
                            var idx = sl[0];
                            var srcpath = vue.relativePath + '/' + vue.datas[idx].name;
                            var tgtpath = vue.relativePath + '/' + this.newPath;
                            axios({
                                method: 'post',
                                data: {
                                    srcRelativePath: srcpath,
                                    targetRelativePath: tgtpath,
                                    serverId: this.serverId
                                },
                                url: "/api/data/move",
                                headers: {'Gcmp-Authorization': this.token}
                            }).then(function (response) {
                                vue.refresh();
                            }).catch(function (err) {
                                handleError(err);
                            });
                        }
                    },
                    rst: function (i, length) {
                        hidErrMsg();
                        if (i == length) {
                            notselectAll();
                            this.refresh();
                        }
                    },

                    move: async function () {
                        $("#moveModal").modal("hide");
                        var selectedList = getSelectedList()
                        for (let i = 0; i < selectedList.length; i++) {
                            var idx = selectedList[i]
                            var srcpath = this.relativePath + '/' + this.datas[idx].name;
                            var tgtpath = this.newPath + '/' + this.datas[idx].name;
                            showErrMsg("正在移动" + this.datas[idx].name + "...", -1)

                            await axios({
                                method: 'post',
                                data: {
                                    srcRelativePath: srcpath,
                                    targetRelativePath: tgtpath,
                                    serverId: this.serverId
                                },
                                url: "/api/data/move",
                                headers: {'Gcmp-Authorization': this.token}
                            }).then(function (response) {
                                vue.rst(i, selectedList.length - 1)
                            }).catch(function (err) {
                                handleError(err);
                            });
                        }
                    },

                    copy: async function () {
                        $("#copyModal").modal("hide");
                        var selectedList = getSelectedList()
                        for (let i = 0; i < selectedList.length; i++) {
                            var idx = selectedList[i]
                            var srcpath = this.relativePath + '/' + this.datas[idx].name;
                            var tgtpath = this.newPath;
                            showErrMsg("正在复制" + this.datas[idx].name + "...", -1)
                            await axios({
                                method: 'post',
                                data: {
                                    srcRelativePath: srcpath,
                                    targetRelativePath: tgtpath,
                                    serverId: this.serverId
                                },
                                url: "/api/data/copy",
                                headers: {'Gcmp-Authorization': this.token}
                            }).then(function (response) {
                                vue.rst(i, selectedList.length - 1)
                            }).catch(function (err) {
                                handleError(err);
                            });
                        }
                    },
                    newDir: function () {
                        $("#newDirModal").modal("hide");
                        var path = this.relativePath + '/' + this.newPath
                        axios({
                            method: 'post',
                            data: {
                                relativePath: path,
                                file: false,
                                serverId: vue.serverId
                            },
                            url: "/api/data/dir",
                            headers: {'Gcmp-Authorization': this.token}
                        }).then(function (response) {
                            vue.refresh();
                        }).catch(function (err) {
                            handleError(err);
                        });
                    },
                    unzip: async function () {
                        var selectedList = getSelectedList()
                        for (let i = 0; i < selectedList.length; i++) {
                            var idx = selectedList[i]
                            var path = vue.relativePath + '/' + vue.datas[idx].name;
                            var file = vue.datas[idx].file;
                            if (file) {
                                showErrMsg("正在解压" + vue.datas[idx].name + "...", -1)
                                await axios({
                                    method: 'post',
                                    data: {
                                        relativePath: path,
                                        file: true,
                                        serverId: vue.serverId
                                    },
                                    url: "/api/data/unzip",
                                    headers: {'Gcmp-Authorization': this.token}
                                }).then(function (response) {
                                    vue.rst(i, selectedList.length - 1)
                                }).catch(function (err) {
                                    handleError(err);
                                });
                            }
                        }
                    },
                    chooseServer: function (serverId) {
                        this.serverId = serverId;
                        this.relativePath = "";
                        this.refresh();
                    },
                    logout: function () {
                        axios({
                            method: "post",
                            url: "/api/user/logout",
                            headers: {'Gcmp-Authorization': this.token}
                        }).then(function (response) {
                            window.location.href = '/'
                        }).catch(function (err) {
                            handleError(err);
                        })
                    }
                },
                filters: {
                    renderSize: function (value, file) {
                        if (file == false) {
                            return "--"
                        }
                        return renderSize(value);
                    }
                }
            });
            WebUploader.Uploader.register({
                "before-send-file": "beforeSendFile",
                "before-send": "beforeSend",
                "after-send-file": "afterSendFile",
            }, {
                //时间点1：所有分块进行上传之前调用此函数
                beforeSendFile: function (file) {
                    file.exised = false;
                    file.target_relative_path = vue.relativePath + '/' + file.name;
                    // console.log("beforeSendFile");
                    // Deferred对象在钩子回掉函数中经常要用到，用来处理需要等待的异步操作。
                    var task = WebUploader.Deferred();
                    // 根据文件内容来查询MD5
                    uploader.md5File(file, 0, md5_siz5).progress(function (percentage) {   // 及时显示进度
                        // console.log('计算md5进度:', percentage);
                        //getProgressBar(file, percentage, "MD5", "MD5");
                    }).then(function (val) { // 完成
                        $('#' + file.id).find('td.state').text('正在上传');
                        // console.log('md5 result:', val);
                        file.file_md5 = val;
                        // 进行md5判断
                        file.chunks = Math.ceil(file.size / chun_size);
                        // console.log(file.size)
                        // console.log(chun_size)
                        axios({
                            method: 'post',
                            data: {
                                serverId: vue.serverId,
                                md5: file.file_md5,
                                totalChunks: file.chunks,
                                chunkSize: chun_size,
                                totalSize: file.size,
                                relativePath: file.target_relative_path
                            },
                            url: "/api/data/chunk/check",
                            headers: {'Gcmp-Authorization': vue.token}
                        }).then(function (response) {
                            var data = response.data;

                            status = data.data.status;

                            if (status == 0) {
                                uploader.skipFile(file);
                                file.exised = true;
                                // console.log("文件已存在");
                            } else {
                                file.existsChunks = data.data.existedChunk;
                                // console.log(data.data.existedChunk)
                            }
                            task.resolve();
                        }).catch(function (err) {
                            handleError(err);
                        })

                    });
                    return task.promise();
                },
                beforeSend: function (block) {
                    file_chunks = block.chunks
                    // console.log("block")
                    var task = WebUploader.Deferred();
                    var file = block.file;
                    var existsChunks = file.existsChunks;
                    var blockChunk = block.chunk + 1;

                    var flag = false;
                    for (var i = 0; i < existsChunks.length; i++) {
                        if (blockChunk == existsChunks[i]) {
                            flag = true;
                            break;
                        }
                    }
                    if (flag) {
                        task.reject();
                    } else {
                        task.resolve();
                        // console.log("当前分块：" + blockChunk);
                    }

                    return task.promise();
                },
                afterSendFile: function (file) {
                    // console.log("finished");
                    var deferred = WebUploader.Deferred();
                    // console.log(file.chunks > 1);
                    //判断是否要分片
                    $('#' + file.id).find('button.btn')[0].style.display = 'none';
                    if (file.chunks > 1 && file.exised == false) {
                        $('#' + file.id).find('td.state').text('正在合并');

                        // log('正在合并...');
                        axios({
                            method: 'post',
                            data: {
                                serverId: vue.serverId,
                                md5: file.file_md5,
                                relativePath: file.target_relative_path,
                                totalChunks: file.chunks
                            },
                            url: '/api/data/chunk/merge',
                            headers: {'Gcmp-Authorization': vue.token}
                        }).then(function (response) {
                            deferred.resolve();
                        }).catch(function (err) {
                            handleError(err);
                        });
                    } else {
                        deferred.resolve();
                    }
                    return deferred.promise();
                }
            });
            var uploader;
            var chun_size = 1024 * 1024 * 8;
            var md5_siz5 = 1024 * 1024 * 10;

            var $list = $("#uploadTable > tbody");
            var count = 0;
            // var map = new HashMap();
            //监听分块上传过程中的三个时间点


            var uploader;
            $('#uploadModal').on('shown.bs.modal', function (e) {

                if (uploader == undefined) {

                    uploader = WebUploader
                        .create({
                            // swf文件路径
                            swf: 'webuploader-0.1.5/Uploader.swf',
                            // 文件接收服务端。
                            server: '/api/data/chunk',
                            // 选择文件的按钮。可选。
                            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                            pick: {
                                id: '#picker',//这个id是你要点击上传文件的id
                                multiple: true
                            },
                            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
                            resize: false,
                            auto: true,
                            //开启分片上传
                            chunked: true,
                            chunkSize: chun_size,   //每一片的大小
                            chunkRetry: 3,              // 如果遇到网络错误,重新上传次数
                            threads: 1,                   // [默认值：3] 上传并发数。允许同时最大上传进程数。
                            prepareNextFile: true,
                            // accept: {
                            //     extensions: "txt,jpg,jpeg,bmp,png,zip,rar,war,pdf,cebx,doc,docx,ppt,pptx,xls,xlsx,iso",
                            //     mimeTypes: '.txt,.jpg,.jpeg,.bmp,.png,.zip,.rar,.war,.pdf,.cebx,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.iso'
                            // }
                        });
                    uploader.on('uploadBeforeSend', function (block, data, headers) {
                        $.extend(headers, {'Gcmp-Authorization': vue.token})
                        //事件里不支持这种用法
                        // var deferred = WebUploader.Deferred();
                        data.relativePath = block.file.target_relative_path;
                        data.serverId = vue.serverId;
                        data.totalChunks = block.chunks;
                        data.chunkNumber = block.chunk + 1;
                        data.md5 = block.file.file_md5;
                    });
                    // 当有文件被添加进队列的时候
                    uploader.on('fileQueued', function (file) {
                        //保存文件扩展名
                        var fileSize = file.size;
                        var fileSizeStr = "";

                        fileSizeStr = WebUploader.Base.formatSize(fileSize);
                        count++;
                        $list.append(
                            '<tr id="' + file.id + '" class="item" flag=0>' +
                            '<td class="index">' + count + '</td>' +
                            '<td class="info">' + file.name + '</td>' +
                            '<td class="size">' + fileSizeStr + '</td>' +
                            '<td class="state">等待上传...</td>' +
                            '<td class="percentage"></td>' +
                            '<td class="operate">' +
                            '<button name="delete" class="btn btn-sm">删除</button></td></tr>');
                    });

                    // 文件上传过程中创建进度条实时显示。
                    uploader.on('uploadProgress', function (file, percentage) {
                        $('#' + file.id).find('td.percentage').text(Math.round(percentage * 99) + '%');
                    });

                    uploader.on('uploadSuccess', function (file) {
                        $('#' + file.id).find('td.percentage').text(Math.round(100) + '%');
                        $('#' + file.id).find('td.state').text('已上传');
                        vue.refresh();

                    });

                    uploader.on('uploadError', function (file) {
                        $('#' + file.id).find('td.state').text('上传出错');
                    });

                    uploader.on('uploadComplete', function (file) {
                        uploader.removeFile(file);
                    });
                }
            })


            $("body").on("click", "#uploadTable button[name='delete']", function () {
                var id = $(this).parents("tr.item").attr("id");
                $(this).parents("tr.item").remove();
                var file = uploader.getFile(id);
                var md5 = file.file_md5;
                var relativePath = file.target_relative_path;
                uploader.removeFile(uploader.getFile(id));
                uploader.stop(uploader.getFile(id), true);
                axios({
                    method: 'delete',
                    data: {
                        serverId: vue.serverId,
                        md5: md5,
                        relativePath: relativePath,
                    },
                    url: '/api/data/chunk',
                    headers: {'Gcmp-Authorization': vue.token}
                }).then(function (data) {
                }).catch(function (err) {
                    handleError(err);
                });

            });

        })

    </script>
</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center" href="javascript:void(0)">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">GCMP</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <li class="nav-item">
            <a class="nav-link" :href="'/server-status.html?token='+token">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>可用资源</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <li class="nav-item">
            <a class="nav-link" :href="'/my-task.html?token='+token">
                <i class="fas fa-fw fa-chart-area"></i>
                <span>我的任务</span></a>
        </li>

        <li class="nav-item active">
            <a class="nav-link" :href="'/my-data.html?token='+token">
                <i class="fas fa-fw fa-folder"></i>
                <span>我的文件</span></a>
        </li>

        <li class="nav-item">
            <a class="nav-link" :href="'/my-image.html?token='+token">
                <i class="fas fa-fw fa-cog"></i>
                <span>我的镜像</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <li class="nav-item">
            <a class="nav-link" :href="'/user-common-image.html?token='+token">
                <i class="fas fa-fw fa-cogs"></i>
                <span>公共镜像</span></a>
        </li>

        <li class="nav-item">
            <a class="nav-link" :href="'/user-common-data.html?token='+token">
                <i class="fas fa-fw fa-table"></i>
                <span>公共数据集</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">


    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-sm-0 static-top shadow">
                <div class="ErrorMessageDiv fade">
                    <span class="alert p-1 border-dark  errorMessage">df</span>
                </div>
                <!-- Topbar Navbar -->
                <ul class="navbar-nav ml-auto">

                    <div class="topbar-divider d-none d-sm-block"></div>

                    <li class="nav-item dropdown no-arrow">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="mr-2 d-none d-lg-inline text-gray-600 small">{{user.username}}</span>

                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                             aria-labelledby="userDropdown">
                            <a @click="logout" class="dropdown-item" href="javascript:void(0)">
                                <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                Logout
                            </a>
                        </div>
                    </li>

                </ul>

            </nav>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class=" ml-auto ">

                <div class="card shadow ">

                    <div class="card-body pt-sm-1">

                        <a class="btn btn-light bnt-square btn-sm" @click="download">
                            <span class="icon text-gray-600">
                            <i class="fas fa-download"></i>
                            </span>
                        </a>

                        <a class="btn btn-light bnt-square btn-sm" data-toggle="modal" data-target="#uploadModal">
                            <span class="icon text-gray-600">
                            <i class="fas fa-upload"></i>
                            </span>
                        </a>
                        <a class="btn btn-light bnt-square btn-sm" @click="remove()">
                            <span class="icon text-gray-600">
                            <i class="fas fa-trash"></i>
                            </span>
                        </a>
                        <div class="btn-group floating">
                            <a type="button" data-toggle="modal" data-target="#renameModal"
                               class="btn btn-light bnt-square btn-sm"><span
                                    class="icon text-gray-600">重命名</span>
                            </a>
                            <a type="button" data-toggle="modal" data-target="#moveModal"
                               class="btn btn-light bnt-square btn-sm "><span
                                    class="icon text-gray-600">移动到</span>
                            </a>
                            <a type="button" data-toggle="modal" data-target="#copyModal"
                               class="btn btn-light bnt-square btn-sm"><span
                                    class="icon text-gray-600">复制到</span>
                            </a>
                            <a @click="unzip" type="button" class="btn btn-light bnt-square btn-sm"><span
                                    class="icon text-gray-600">解压</span>
                            </a>
                            <a type="button" data-toggle="modal" data-target="#newDirModal"
                               class="btn btn-light bnt-square btn-sm"><span
                                    class="icon text-gray-600">创建文件夹</span>
                            </a>
                            <div class="dropdown">
                                <button class="btn btn-light bnt-square btn-sm dropdown-toggle text-gray-600"
                                        type="button"
                                        id="dropdownMenuButton"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    选择服务器：{{serverId}}
                                </button>
                                <div class="dropdown-menu animated--fade-in" aria-labelledby="dropdownMenuButton">

                                    <a type="button" v-for="gpus,i in availableGpus"
                                       class=" text-gray-600 pt-0 pb-0 dropdown-item"
                                       href="javascript:void(0)"
                                       @click="chooseServer(i)">
                                        {{i}}: {{gpus}} GPU空闲</a>

                                </div>
                            </div>
                        </div>

                        <ol class="breadcrumb mt-1 p-1 bg-white mb-0">

                            <li class="text-dark" @click="jumpDir(-1)"><a href="javascript:void(0)">...</a></li>
                            <li v-for="item,i in pathItems" class="breadcrumb-item text-dark" @click="jumpDir(i)"
                                :class={'active':i+1==pathItems.length}>
                                <span v-if="i+1==pathItems.length">{{item}}</span>
                                <span v-else><a href="javascript:void(0)">{{item}}</a></span>
                            </li>

                        </ol>


                        <div class="table-status table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">

                                <thead>
                                <tr>
                                    <th class="selectAndImage ">
                                        <img @click="selectAll($event)" selectedd="false" class="selectAll"
                                             src="/img/notSelected.png">
                                    </th>
                                    <th width="60%">文件名</th>
                                    <th width="30%">大小</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="d,i in datas">
                                    <td>
                                        <img @click="selectSingle($event)" selectedd="false" :idx="i"
                                             class="selectSingle" src="/img/notSelected.png">
                                    </td>
                                    <td v-if="d.file">{{d.name}}</td>
                                    <td v-else @click="intoDir"><a href="javascript:void(0)">{{d.name}}</a></td>
                                    <td>{{d.size|renderSize(d.file)}}</td>
                                </tr>

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>Copyright &copy; GCMP 2020</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

    <div class="modal fade" id="newDirModal" tabindex="-1" role="dialog" aria-labelledby="newDirModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="p-3">
                    <input v-model="newPath" type="text" class="form-control" placeholder="新的文件(夹)名">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <a class="btn btn-primary" @click="newDir">确定</a>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade" id="renameModal" tabindex="-1" role="dialog" aria-labelledby="renameModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="p-3">
                    <input v-model="newPath" type="text" class="form-control" placeholder="新的文件(夹)名">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <a class="btn btn-primary" @click="rename">确定</a>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade" id="moveModal" tabindex="-1" role="dialog" aria-labelledby="moveModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="p-3">
                    <input v-model="newPath" type="text" class="form-control" placeholder="新的父文件夹路径，根目录为/">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <a class="btn btn-primary" @click="move">确定</a>
                </div>
            </div>

        </div>
    </div>
    <div class="modal fade" id="copyModal" tabindex="-1" role="dialog" aria-labelledby="copyModal"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="p-3">
                    <input v-model="newPath" type="text" class="form-control" placeholder="新的父文件夹路径，根目录为/">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <a class="btn btn-primary" @click="copy">确定</a>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModal"
     aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="p-3">
                <table class="table table-striped table-bordered" id="uploadTable">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>文件名称</th>
                        <th>文件大小</th>
                        <th>上传状态</th>
                        <th>上传进度</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>


            <div class="modal-footer">
                <div class="panel-footer">
                    <div id="picker" class="p-0">选择文件</div>
                </div>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>

<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


</body>

</html>
